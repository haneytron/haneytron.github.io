<!DOCTYPE html>
<html lang="en" data-theme="dark"><head>
    <title>Who Loves Interns? | David Haney</title>
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-2YNL1EJF5C"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  
	</script>
	
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-PR2HVYP6QG"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());
	  gtag('config', 'G-PR2HVYP6QG');
	</script>
    
    <meta charset="utf-8"><meta name="generator" content="Hugo 0.78.1" /><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
    <meta name="description" content="Programmer / Engineering Manager">
    
    <link rel="stylesheet"
          href="https://www.davidhaney.io/css/style.min.2b188541d728e8afd69a6f1b8b83f89f2b138d671fb728eff20ff3f3dcf5b55e.css"
          integrity="sha256-KxiFQdco6K/Wmm8bi4P4nysTjWcftyjv8g/z89z1tV4="
          crossorigin="anonymous"
          type="text/css">
    <link rel="stylesheet"
          href="https://www.davidhaney.io/css/syntax.21cc1ccec065ce1e0f94f7a6a5a26cb58c9044e659b5010305c81fe0a1d47029.css"
          integrity="sha256-IcwczsBlzh4PlPempaJstYyQROZZtQEDBcgf4KHUcCk="
          crossorigin="anonymous"
          type="text/css"><link rel="stylesheet" 
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" 
    integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" 
    crossorigin="anonymous" />

    
    <link rel="shortcut icon" href="https://www.davidhaney.io/favicons/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" sizes="180x180" href="https://www.davidhaney.io/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://www.davidhaney.io/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://www.davidhaney.io/favicons/favicon-16x16.png">

    <link rel="canonical" href="https://www.davidhaney.io/who-loves-interns/">

    
    
    
    
    <script type="text/javascript"
            src="https://www.davidhaney.io/js/anatole-header.min.e782db136ec18d105a4552702eac49f4620d6867da3fbf808bd53e806c96be6e.js"
            integrity="sha256-54LbE27BjRBaRVJwLqxJ9GINaGfaP7&#43;Ai9U&#43;gGyWvm4="
            crossorigin="anonymous"></script>
    <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://www.davidhaney.io/img/opengraph.png"/>

<meta name="twitter:title" content="Who Loves Interns?"/>
<meta name="twitter:description" content="The topic at hand is interning. More specifically, string interning.
‚ÄúWhat is string interning?‚Äù you ask? Good question. As you may or may not know, strings are immutable reference types. This means that they are read-only and a pointer will refer to the string‚Äôs location on the heap."/>

</head>
<body><div class="sidebar animated fadeInDown">
    <div class="logo-title">
        <div class="title">
            <img src="https://www.davidhaney.io/img/me.jpg" alt="profile picture">
            <h3 title=""><a href="/">David Haney</a></h3>
            <div class="description">
                <p>Programmer / Engineering Manager</p>
            </div>
        </div>
    </div>
    <ul class="social-links">
        
            <li>
                <a href="https://www.github.com/haneytron" rel="me" aria-label="GitHub">
                    <i class="fab fa-github fa-2x" aria-hidden="true"></i>
                </a>
            </li>
        
            <li>
                <a href="https://www.twitter.com/haneytron" rel="me" aria-label="Twitter">
                    <i class="fab fa-twitter fa-2x" aria-hidden="true"></i>
                </a>
            </li>
        
            <li>
                <a href="https://www.linkedin.com/in/davidahaney" rel="me" aria-label="Linkedin">
                    <i class="fab fa-linkedin fa-2x" aria-hidden="true"></i>
                </a>
            </li>
        
    </ul>
    <div class="footer">
        <div class="by_farbox">&copy; David Haney 2020 </div>
    </div>
</div>
<div class="main">
    <div class="page-top animated fadeInDown">
    <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
    </a>
    <ul class="nav" id="navMenu">
        
        
            
            <li><a 
                   href="/"
                        
                   title="">Home</a></li>
        
            
            <li><a 
                   href="/post/"
                        
                   title="">Posts</a></li>
        
            
            <li><a 
                   href="/tags/"
                        
                   title="">Tags</a></li>
        
        
        <li class="theme-switch-item">
            <a class="theme-switch" title="Switch Theme">
                <i class="fa fa-adjust fa-fw" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>

    <div class="autopagerize_page_element">
        <div class="content">
    <div class="post animated fadeInDown">
        <div class="post-content">

            <div class="post-title">
                <h3>Who Loves Interns?</h3>
                
                    <div class="info">
                        <em class="fa fa-sun-o"></em>
                        <span class="date">Wed, May 2, 2012</span>
                        <em class="fa fa-clock-o"></em>
                        <span class="reading-time">6-minute read</span>
                    </div>
                
            </div>

            <p>The topic at hand is interning. More specifically, string interning.</p>
<p>‚ÄúWhat is string interning?‚Äù you ask? Good question. As you may or may not know, strings are immutable reference types. This means that they are read-only and a pointer will refer to the string‚Äôs location on the heap. Typically, a new string is created and stored within your application‚Äôs memory each time that you assign a string ‚Äì <em>even if the same string is defined repeatedly.</em> What this means is that you can define the same string N times and have it take up the string‚Äôs memory N times. This sucks when dealing with repeating string data.</p>
<p>Enter string interning. <strong>String interning is the process by which you defer your string reference to the .NET runtime‚Äôs string intern pool, thereby conserving memory as N identical strings point to the same single reference</strong>. From <!-- raw HTML omitted -->MSDN<!-- raw HTML omitted -->:</p>
<p>‚ÄúThe common language runtime conserves string storage by maintaining a table, called the intern pool, that contains a single reference to each unique literal string declared or created programmatically in your program. Consequently, an instance of a literal string with a particular value only exists once in the system. For example, if you assign the same literal string to several variables, the runtime retrieves the same reference to the literal string from the intern pool and assigns it to each variable. The Intern method uses the intern pool to search for a string equal to the value of str. If such a string exists, its reference in the intern pool is returned. If the string does not exist, a reference to str is added to the intern pool, then that reference is returned.‚Äù</p>
<p>Up until this point, you may not have been aware of this pool or the string interning behaviour at all. This is understandable because the .NET compiler does a bloody good job of interning strings for you. In fact, any literal string will be automatically interned by the compiler. Almost any late-bound (at runtime) string, however, is not. A quick code example ‚Äì let us define a program that simply creates 10,000,000 of the same string and assigns it to a Dictionary:</p>
<pre><code>class Program
{
    // The Dictionary that will be used to store our strings at an int 
    // (so that they are not de-referenced and GC'd)
    private static readonly IDictionary&lt;int, string&gt; _dict = new Dictionary&lt;int, string&gt;();

    static void Main(string[] args)
    {
        Console.WriteLine(&quot;Storing a non-constant string 10000000 times&quot;);

        var stopwatch = new Stopwatch();
        stopwatch.Start();

        // Loop 10,000,000 times
        for (int i = 0; i &lt; 10000000; i++)
        {
            // Define the same string repeatedly
            string blah = &quot;Hello! This Is A String!&quot;;
            // Add it to the Dictionary at the index of i
            _dict.Add(i, blah);
        }

        stopwatch.Stop();

        Console.WriteLine(&quot;Memory Used: &quot; + Process.GetCurrentProcess().PagedMemorySize64.ToString(&quot;n&quot;) + &quot; bytes&quot;);
        Console.WriteLine(&quot;Elapsed milliseconds: &quot; + stopwatch.ElapsedMilliseconds);

        Console.WriteLine(&quot;Press any key&quot;);
        Console.ReadKey();
    }
}
</code></pre>
<p>Running this program results in the following output:</p>
<figure>
    <img src="/img/repeated-literal-string.png"/> <figcaption>
            <h4>A Repeated Literal String</h4>
        </figcaption>
</figure>

<p>It uses a relatively small amount of memory (269 megs) and takes very little time, since the compiler detects that the string which we‚Äôre creating is a literal and thus interns it for us automatically. Now, let us make a slight change to the application by creating a late-bound string which won‚Äôt be interned automatically:</p>
<pre><code>class Program
{
    // The Dictionary that will be used to store our strings at an int 
    // (so that they are not de-referenced and GC'd)
    private static readonly IDictionary&lt;int, string&gt; _dict = new Dictionary&lt;int, string&gt;();

    static void Main(string[] args)
    {
        // Define a string which will be concatenated with another string later
        string dynamicString = &quot;Some Other Large String&quot;;

        Console.WriteLine(&quot;Storing a non-constant string 10000000 times&quot;);

        var stopwatch = new Stopwatch();
        stopwatch.Start();

        // Loop 10,000,000 times
        for (int i = 0; i &lt; 10000000; i++)
        {
            // Define the same string repeatedly
            string blah = &quot;Hello! This Is A String!&quot; + dynamicString;
            // Add it to the Dictionary at the index of i
            _dict.Add(i, blah);
        }

        stopwatch.Stop();

        Console.WriteLine(&quot;Memory Used: &quot; + Process.GetCurrentProcess().PagedMemorySize64.ToString(&quot;n&quot;) + &quot; bytes&quot;);
        Console.WriteLine(&quot;Elapsed milliseconds: &quot; + stopwatch.ElapsedMilliseconds);

        Console.WriteLine(&quot;Press any key&quot;);
        Console.ReadKey();
    }
}
</code></pre>
<p>Running THIS code yields crappier results:</p>
<figure>
    <img src="/img/repeated-late-bound-string.png"/> <figcaption>
            <h4>Repeated Late Bound String</h4>
        </figcaption>
</figure>

<p>Note that we use nearly <strong>five times</strong> as much memory (1.379 gigs) as we did before! And that our application got considerably slower! Sadly, we can‚Äôt do much about the slower part because concatenating strings takes time and effort. However, we can intern the string to return our memory usage back to something realistic while adding minimal computational cost. We do this with the <strong>string.Intern(string)</strong> method:</p>
<pre><code>class Program
{
    // The Dictionary that will be used to store our strings at an int 
    // (so that they are not de-referenced and GC'd)
    private static readonly IDictionary&lt;int, string&gt; _dict = new Dictionary&lt;int, string&gt;();

    static void Main(string[] args)
    {
        // Define a string which will be concatenated with another string later
        string dynamicString = &quot;Some Other Large String&quot;;

        Console.WriteLine(&quot;Storing a non-constant string 10000000 times&quot;);

        var stopwatch = new Stopwatch();
        stopwatch.Start();

        // Loop 10,000,000 times
        for (int i = 0; i &lt; 10000000; i++)
        {
            // Define the same string repeatedly
            string blah = &quot;Hello! This Is A String!&quot; + dynamicString;
            // Add it to the Dictionary at the index of i
            // Intern string &quot;blah&quot; to save memory!
            _dict.Add(i, string.Intern(blah));
        }

        stopwatch.Stop();

        Console.WriteLine(&quot;Memory Used: &quot; + Process.GetCurrentProcess()
            .PagedMemorySize64.ToString(&quot;n&quot;) + &quot; bytes&quot;);
        Console.WriteLine(&quot;Elapsed milliseconds: &quot; + stopwatch.ElapsedMilliseconds);

        Console.WriteLine(&quot;Press any key&quot;);
        Console.ReadKey();
    }
}
</code></pre>
<p>And the results:</p>
<figure>
    <img src="/img/repeated-late-bound-string-interned.png"/> <figcaption>
            <h4>Repeated Late Bound String (Interned)</h4>
        </figcaption>
</figure>

<p>Note that by interning the late-bound string, we reduced memory usage considerably (272 megs, with only an additional 4 megs used for pointers) while adding only a minimal amount of additional computation (600 milliseconds)‚Ä¶ 80% less memory used for the cost of an additional 20% computation is generally a good trade.</p>
<p>Now the icing on the cake. Compile and run your code in <strong>Release mode</strong> to allow for even more compiler optimizations:</p>
<figure>
    <img src="/img/repeated-late-bound-string-interned-release-mode.png"/> <figcaption>
            <h4>Repeated Late Bound String (Interned) - Release Mode</h4>
        </figcaption>
</figure>

<p>Even less memory and even less interning costs! It‚Äôs win-win and just a friendly reminder to always release your code in Release mode. üôÇ</p>
<p>So, who loves interns? You do. <strong>Remember: when you must use the same string repeatedly in an application (perhaps when storing a huge collection of User objects with a FirstName property, where many of your users are ‚ÄúDavid‚Äù, ‚ÄúJohn‚Äù, ‚ÄúTim‚Äù, etc.), intern the string.</strong> Why create N copies of the exact same object, all using up your precious managed memory?</p>

        </div>
        <div class="post-footer">
            <div class="info">
                <span class="separator"><a class="category" href="/categories/blog/">blog</a></span>

                <span class="separator"><a class="tag" href="/tags/dotnet/">dotnet</a><a class="tag" href="/tags/csharp/">csharp</a><a class="tag" href="/tags/memory/">memory</a><a class="tag" href="/tags/performance/">performance</a><a class="tag" href="/tags/programming/">programming</a></span>

            </div>
        </div>

        
            <div id="fb_comments_container">
                    <h2>comments</h2>
                    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "haney" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
                </div>
        
    </div>


        </div>
    </div>
</div>

<script type="text/javascript"
        src="https://www.davidhaney.io/js/jquery.min.86b1e8f819ee2d9099a783e50b49dff24282545fc40773861f9126b921532e4c.js"
        integrity="sha256-hrHo&#43;BnuLZCZp4PlC0nf8kKCVF/EB3OGH5EmuSFTLkw="
        crossorigin="anonymous"></script>




<script type="text/javascript"
        src="https://www.davidhaney.io/js/bundle.min.0f9c74cb78f13d1f15f33daff4037c70354f98acfbb97a6f61708966675c3cae.js"
        integrity="sha256-D5x0y3jxPR8V8z2v9AN8cDVPmKz7uXpvYXCJZmdcPK4="
        crossorigin="anonymous"></script>

<script type="text/javascript"
        src="https://www.davidhaney.io/js/medium-zoom.min.92f21c856129f84aeb719459b3e6ac621a3032fd7b180a18c04e1d12083f8aba.js"
        integrity="sha256-kvIchWEp&#43;ErrcZRZs&#43;asYhowMv17GAoYwE4dEgg/iro="
        crossorigin="anonymous"></script>
</body>

</html>
